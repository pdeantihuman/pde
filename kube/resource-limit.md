# Docker 资源限制

## 内存

### 了解内存不足的风险

不要让正在运行的容器消耗太多主机内存，这一点很重要。在Linux主机上，如果内核检测到没有足够的内存来执行重要的系统功能，它会抛出OOME或内存不足异常，并开始终止进程以释放内存。任何过程都可能被扼杀，包括 Docker 和其他重要的应用。如果错误的进程被终止，这可以有效地使整个系统瘫痪。

Docker试图通过调整Docker守护进程上的OOM优先级来减轻这些风险，这样它比系统上的其他进程更不容易被杀死。容器上的OOM优先级没有调整。这使得单个容器比Docker守护进程或其他系统进程更有可能被杀死。您不应该试图通过在守护进程或容器上手动将`--oom-score-adj`设置为一个极端负数，或者通过在容器上设置`--oom-kill-disable`来规避这些安全措施。

有关Linux内核面向对象管理的更多信息，请参见内存不足管理。

您可以通过以下方式降低因OOME而导致的系统不稳定风险:

- 在投入生产之前，执行测试以了解应用程序的内存需求。
- 确保您的应用程序仅在资源充足的主机上运行。
- 如下所述，限制容器可以使用的内存量。
- 在您的备审主机上配置交换时要小心。交换比内存更慢、性能更差，但可以提供缓冲区来防止系统内存耗尽。
- 考虑将容器转换为服务，并使用服务级别约束和节点标签来确保应用程序仅在具有足够内存的主机上运行

### 限制容器对内存的访问

Docker可以强制执行硬内存限制，这允许容器使用不超过给定数量的用户或系统内存，或者强制执行软限制，这允许容器使用所需的内存，除非满足某些条件，例如内核检测到主机内存不足或争用。当单独使用或设置多个选项时，这些选项中的一些具有不同的效果。

大多数选项采用正整数，后跟b、k、m、g后缀，表示字节、千字节、兆字节或千兆字节。

## GPU

1. GPU的驱动
2. `nvidia-container-runtime`
3. `gpus` 可以配置GPU资源